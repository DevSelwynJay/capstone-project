<script>
    jQuery(document).ready(function() {
        // $(".clickable-row").click(function() {
        //     window.location = $(this).data("href");
        // });
        var table = $('#emr-req-cont').tableSortable({
            data: [],
            columns:
                {
                    complete_name:"Name",
                    email:"Email",
                    date_requested:"Date Requested",
                    view_button:"Action"
                }
            ,
            // searchField: '.search-bar',
            responsive: {
                720: {
                    columns: {
                        complete_name:"Name",
                        email:"Email",
                        date_requested:"Date Requested",
                        view_button:"Action"

                    },
                },
            },
            rowsPerPage: 5,
            pagination: true,
            tableWillMount: function() {
                console.log('table will mount')
            },
            tableDidMount: function() {
                console.log('table did mount')
            },
            tableWillUpdate: function() {console.log('table will update')},
            tableDidUpdate: function() {
                console.log('table did update')
                row_click()
            },
            tableWillUnmount: function() {console.log('table will unmount')},
            tableDidUnmount: function() {console.log('table did unmount')},
            onPaginationChange: function(nextPage, setPage) {
                setPage(nextPage);
            }
        });
        $.post('php/approveEMR/retrieveOA_EMR_request.php', function(data) {
            d = data;
            // Push data into existing data
            console.log(JSON.parse(data))
            //table.setData(JSON.parse(data), null, true);

            // or Set new data on table, columns is optional.
            table.setData(JSON.parse(data),{
                complete_name:"Name",
                email:"Email",
                date_requested:"Date Requested",
                view_button:"Action"
            });

        })//end of get/post method
        $('#changeRows').on('change', function() {
            table.updateRowsPerPage(parseInt($(this).val(), 10));
        })

        $('#rerender').click(function() {
            table.refresh(true);
        })

        $('#distory').click(function() {
            table.distroy();
        })

        $('#refresh').click(function() {
            table.refresh();
        })

        $('#setPage2').click(function() {
            table.setPage(1);
        })

        //========Action Function======================//
        function row_click() {
            $("tr").click(function () {
                let a =  $(this).children();
                let id =  $($(this).children()[0]).html();//get the ID
                console.log(id)
                if(id.indexOf("gs-button")!=-1){
                    return; //cancel code because table header was clicked
                }
                // setTimeout(()=>{
                //     $.post('php/patientProcesses/setPatientSessionID.php',{id:id}).done(
                //         function (data) {
                //             //alert(data)
                //             location.href="individual-patient.php"
                //         }
                //     )
                // },500)

                //console.log(a[0].innerHTML)//just another way
            })

            $(".view-req-btn").off('click');
            $(".view-req-btn").click(function (data){
                let patientOA_ID = $(this).data("patientoa_id");
                let email = $(this).data("email");
                let name = $(this).data("name");
                let reqID = $(this).data("reqid");
                $("#pop-up-view-req").modal({
                    showClose:false
                })
                $("#view-emr-name").html(name);
                $("#view-emr-email").html("("+email+")");
                // alert(patientOA_ID)
                $.post("php/approveEMR/activeEMRSession.php",{
                    patientOA_ID:patientOA_ID,
                    reqID:reqID
                }).done(function (data) {
                   // alert(data)
                })
            })
        }
    });//end of document ready
</script>
<!--Modal for view emr request-->
<div id="pop-up-view-req" class="modal">
    <div class="flex-box-row justify-content-center align-items-center">
        <img src="img/HIS%20logo%20blue.png" width="150" height="60">
    </div>
    <h3 style="color: var(--third-color);text-align: center" class="margin-top-1">Requesting EMR</h3>
    <p class="modal-p-2" style="text-align: center!important;margin-top: 0.5rem;color: black;!important;">
        <span id="view-emr-name" style="color: inherit">Alfredo Bas Benitez </span>
        <span id="view-emr-email" style="color: inherit">(sample@gmail.com)</span>
    </p>
    <p class="modal-p-2" style="text-align: center!important;color: black!important;">
        is requesting for Electronic Medical Record
    </p>
    <p class="modal-p-2" style="margin-top: 1rem">
        Electronic Medical Record (EMR) consist of all the medication and vaccination taken by the patient.
    </p>
    <div class="flex-box-column align-items-center justify-content-center margin-top-3">
        <button id="generate-emr">
            Generate EMR
        </button>
        <a href="emr_gen.php" target="_blank">
            <button>
                View the generated EMR
            </button>
        </a>

        <a href="#pop-up-view-req" rel="modal:close">
            <button id="cancel-generate-emr">
                Cancel
            </button>
        </a>

        <style>
            #generate-emr{
                font-family:Poppins;font-size: large;background: var(--primary-color);color: white;padding: 0.8rem 0.5rem;border: none
            }#generate-emr:hover{
                 background: var(--hover-color);
             }
             #cancel-generate-emr{
                 font-family:Poppins;font-size: medium;background: #c40d1b;color: white;padding: 0.3rem 0.5rem;border: none;
                 margin-top: 0.5rem;
             }#cancel-generate-emr:hover{
                           background: #e24653;
                           }
        </style>
    </div>

</div>

<!--Modal for loading-->
<div id="pop-up-loading" class="modal">
    <div style="display: flex;align-items: center;justify-content: center">
        <div class="loader"></div>
        <p class="modal-p" id="pop-up-loading-message" style="display: flex;justify-content: center;margin-left: 1rem">
            Retrieving Info...
        </p>
    </div>
</div>