<script>
    $("#meds").keyup(function () {

        $(function() {

            (function(name) {
             // alert($("#meds").val())

                $.post("php/testingCode/retrieveInventory.php",{isSearch:true,val:$("#meds").val()}).done(function (data) {
                    let response = JSON.parse(data);
                    var container = $(name);
                    var sources = function () {
                        var result = response;

                        // for (const responseElement of response) {
                        //     result.push(responseElement.id)
                        // }

                        // for (var i = 1; i < 196; i++) {
                        //     result.push(i);
                        // }

                        return result;
                    }();

                    var options = {
                        dataSource: sources,
                        pageSize: 5,
                        callback: function (response, pagination) {
                            window.console && console.log(response, pagination);

                            // var dataHtml = '<ul>';
                            //
                            // $.each(response, function (index, item) {
                            //     dataHtml += '<li data-id="'+item.id+'" class="root-inv">' + item.name + '</li>';
                            // });
                            //
                            // dataHtml += '</ul>';

                            var dataHtml = '';

                             dataHtml += '<div><th colspan="7" style="text-align: start!important;color: white!important;">Inventory</th></div>'

                            $.each(response, function (index, item) {

                                dataHtml+="<div class='root-inv root-inv-"+item.name+"'>"

                                dataHtml+= "<div  style='text-align: start;color: black'>"
                                            +"<button class='root-action' data-name='"+item.name+"' style='margin-right: 0.4rem'> Expand </button>"
                                            +item.name+" "+item.stock+" "+
                                            "</div>"

                                dataHtml+="<tbody class='2-root-inv 2-root-inv-"+item.name+"' style='margin-bottom: 1.5rem'></tbody>"

                                dataHtml+="</div>"



                            });

                            container.prev().html(dataHtml);

                            //expand was click
                            $(".root-action").click(function () {

                                let inv_name = $(this).data("name");

                                $(".child-inv-"+inv_name).remove()

                                if($(this).html()=="Collapse"){

                                    $(this).html("Expand")//sa huli to wag iuuna
                                    return
                                }

                                $(this).html("Collapse")//sa huli to wag iuuna

                                $.post("php/testingCode/retIndiv.php",{name:inv_name}).done(function (data) {
                                    let child = ""
                                    //ung sa drop down pababa
                                    let result = JSON.parse(data);
                                    let length = result.length
                                    let ctr=1;
                                    let margin=""
                                    console.log(data)
                                    // alert(length)


                                    // child+=;
                                    $(".2-root-inv-"+inv_name).append("<tr class='child-inv child-inv-"+inv_name+"'><td>ID</td><td>Name</td><td>Category</td><td>Dosage</td><td>Stock</td><td>Date Added</td><td>Action</td></tr>")

                                    for (const resultElement of result) {

                                        if(length==ctr){
                                            margin="margin-bottom:1rem;padding-bottom:1rem"
                                        }
                                        if(ctr==1){
                                            margin="padding-top:1rem"
                                        }


                                        $(".2-root-inv-"+inv_name).append("" +
                                            "<tr class='child-inv child-inv-"+inv_name+"' style='"+margin+"'>" +
                                            "<td colspan=''>"+resultElement.id+"</td>" +
                                            "<td colspan=''>"+resultElement.name+"</td>" +
                                            "<td colspan=''>"+resultElement.category+" "+resultElement.subcategory+"</td>" +
                                            "<td colspan=''>"+resultElement.dosage+"</td>" +
                                            "<td colspan=''>"+resultElement.stock+"</td>" +
                                            "<td colspan=''>"+resultElement.dateadded+"</td>" +
                                            "<td colspan=''><button>Update</button></td>"+
                                            "</tr>")
                                        ctr+=1;

                                    }
                                    // $(".root-inv-"+inv_name).append("</table>")
                                })

                            })

                        }
                    };

                    //$.pagination(container, options);

                    container.addHook('beforeInit', function () {
                        window.console && console.log('beforeInit...');
                    });
                    container.pagination(options);

                    container.addHook('beforePageOnClick', function () {
                        window.console && console.log('beforePageOnClick...');
                        //return false
                    });
                })

            })('#inv-table');

        })
    })//click function



  $(window).click(function () {
      jQuery('tr').each(function(){
          if( jQuery(this).html() == '&nbsp;' ||jQuery(this).html() == '')
              jQuery(this).remove();
      })
  })

    $("#meds").trigger("keyup")
</script>
<style>
    .child-inv {
        background: whitesmoke!important;
    }
    .root-action{
        padding: 0.5em;
        border:none;
        outline: none;
        background: var(--primary-color);
        color: var(--secondary-color);
    }
</style>