<div class="modal modal-md-width" id="add-pres-modal">
    <div class="flex-box-row justify-content-center" style="border-bottom: 2px solid #F4F2F4;padding-bottom: 1rem;margin: 0.5rem 15px 0 15px">
        <h4 style="color: var(--third-color);display: flex;align-items: center">
            <img src="img/prescription.png" class="modal-icon-wider" style="margin-right: 0.3rem">
            <!--                <i class="fas fa-file-prescription fa-2x" style="margin-right: 0.5rem"></i>-->
            Prescription
        </h4>
    </div>
    <div id="modal-upper-info" class="row flex-box-row justify-content-center" style="padding-bottom: 1rem;margin: 0.5rem 15px 0 15px;border-bottom: 2px solid #F4F2F4;">
        <div class="col-sm-6">
            <p class="modal-p-2"><i class="fas fa-user-alt " style="margin-right: 0.3rem"></i><span id="modal-patient-name" >To: Alfredo B. Benitez</span></p>
        </div>
        <div class="col-sm-6 flex-box-row justify-content-between">
            <p class="modal-p-2"><i class="fas fa-file-alt " style="margin-right: 0.3rem"></i><span id="modal-patient-type" >Type: Adult</span></p>
            <a class="tooltip allergies-txt" title="">
                <button class="modal-primary-button" id="view-allergies-btn" style="zoom: 70%;" title=""><i class="fas fa-allergies" style="margin-right: 0.3rem"></i>View Allergies</button>
            </a>
        </div>
        <div class="col-sm-6 flex-box-row justify-content-start padding-left-15">
            <p class="modal-p-2">
                <i class="fas fa-hand-holding" style=""></i>
                <span id="modal-admin-name">Given by: DR kwakwak</span>
            </p>
        </div>
        <div class="col-sm-6 flex-box-row justify-content-start padding-left-15">
            <p class="modal-p-2">
                <i class="fas fa-calendar-alt"></i>
                <span id="modal-curr-date"></span>
            </p>
        </div>
<!--        <div class="flex-box-column align-items-end" style="flex: 1 1 50%">-->
<!--            <p id="modal-curr-date" class="modal-p-2"></p>-->
<!--            <p id="modal-admin-name" class="modal-p-2">Given by: DR kwakwak</p>-->
<!--        </div>-->
        <script>
            let date= new Date()
            const options = {  year: 'numeric', month: 'long', day: 'numeric' };
            $("#modal-curr-date").html(date.toLocaleDateString(undefined,options))
        </script>
    </div>
    <div class="padding-all-15 margin-top-1">
        <!--Searchbar-->
        <div  class="row flex-box-row justify-content-sm-end justify-content-lg-center">
            <div class="col-lg-8 col-md-7 col-sm-8" >
                <p class="modal-p-2" style="margin-bottom: 0.2rem!important;">Type the Medicine/Vaccine to Give</p>
                <div class="search-container-2">
                    <a href="/"><i class="fas fa-search"></i></a>
                    <input type="text" id="search-inv" class="search-bar-2" placeholder="" style="font-weight: bold">
                </div>
            </div>
        </div>
        <style>
            .search-container-2{
                color: var(--third-color)!important;
                display: flex;
                flex-flow: row;
                background: #f1f4ff;
                border-radius: 0.4rem;
                box-shadow: 0px 2px 7px -1px rgba(0,0,0,0.5);
                -webkit-box-shadow: 0px 2px 7px -1px rgba(0,0,0,0.5);
                -moz-box-shadow: 0px 2px 7px -1px rgba(0,0,0,0.5);
            }
            .search-container-2 a{
                flex: 0 1 auto;
                display: flex;
                justify-content: end;
                padding: 0.5rem 0.5rem 0.5rem 0.5rem !important;
                color: inherit;
            }
            .search-container-2 .search-bar-2{
                flex: 0 1 90%;
                margin: 0 !important;
                border: none !important;
                padding: 0.6rem 1rem !important;
                background: none !important;
                border-radius: 0 !important;
            }
            .search-container-2 .search-bar-2:focus{
                border: 1px solid #D4D7D9 !important;
            }
        </style>


<!--        &lt;!&ndash;Searchbar&ndash;&gt;-->
<!--        <div  class="row flex-box-row justify-content-sm-end justify-content-md-center">-->
<!--            <div class="col-lg-8 col-md-7 col-sm-8" >-->
<!--                <label class="><span style="color: red">*</span>Search for Medicine</label>-->
<!--                <div class="search-container">-->
<!--                    <input type="text" id="search-inv" class="search-bar">-->
<!--                    <a href="/"><i class="fas fa-search"></i></a>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
        <!--first row-->
        <div class="row flex-box-row justify-content-center margin-top-1">
            <div class="col-lg-6 col-md-12 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 ">Selected <span id="inv-category-lbl">Medicine</span></label>
                    <input id="inv-name" type="text" class="search-bar" placeholder="none" readonly style="font-weight: bold">
            </div>
            <div class="col-lg-3 col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 ">Type</label>
                    <input id="inv-type" class="search-bar" type="text" placeholder="none" readonly>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 "><span id="sub-category-lbl">Medicine</span> Category</label>
                <input id="sub-category" class="search-bar" type="text" placeholder="none" readonly>
            </div>

        </div>

        <!--row-->
<!--        <div class="row flex-box-row justify-content-center">-->
<!--            <div class="col-lg-6 col-sm-11">-->
<!--                <label class="modal-p-2"><span style="color: red">*</span>Frequency</label>-->
<!--                <div class="flex-box-row justify-content-center">-->
<!--                    <input type="radio" name="frequency" value="Daily">-->
<!--                    <label class=" style="margin-right: 0.5rem">Daily</label>-->
<!--                    <input type="radio" value="Daily">-->
<!--                    <label class=">Every other day</label>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="col-lg-6 col-sm-11">-->
<!--                <label class="modal-p-2"><span style="color: red">*</span>Interval /day</label>-->
<!--                <input type="number" id="interval" class="search-bar" placeholder="dosage">-->
<!--            </div>-->
<!--        </div>-->


        <!--row--> <!--for add med UI-->
        <div id="add-med-UI-cont" style="display: block">
            <div class="row flex-box-row justify-content-center">

                <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2 ">Dosage</label>
                    <input type="text" id="dosage" class="search-bar" placeholder="x" readonly>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2 "><span style="color: red">*</span>Times per day</label>
                    <input type="number" id="no_of_times" class="search-bar" placeholder="x">
                </div>
                <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2 ">Frequency</label>
                    <select id="frequency" class="search-bar">
                        <option value="0">Daily</option>
                        <option value="1">Every other day</option>
                    </select>
                    <script>
                        $("#frequency").change(function () {
                            let val =  $(this).val();
                            if(val==0){
                                $("#interval-lbl").css('opacity','0.3')
                                $("#interval").prop('type','text').val("none").css('opacity','0.3').prop('readonly',true)
                            }
                            else {
                                $("#interval-lbl").css('opacity','1')
                                $("#interval").val("").css('opacity','1').prop('type','number').prop('readonly',false).val(1)
                            }
                        })
                    </script>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2" id="interval-lbl">Interval in days</label>
                    <input type="text" id="interval" class="search-bar" placeholder="x" readonly>
                    <script>
                        $("#interval-lbl").css('opacity','0.3')
                        $("#interval").val("None").css('opacity','0.3')
                    </script>
                </div>

            </div>

            <!--row-->
            <div class="row flex-box-row justify-content-center" style="border-bottom: 2px solid #F4F2F4;padding-bottom: 1rem">
                <div class="col-lg-3  col-md-3 col-sm-11 flex-box-column justify-content-start margin-top-2">
                    <label class="modal-p-2 "><span style="color: red">*</span>Start Date</label>
                    <input id="start-date" class="search-bar" type="text" placeholder="Start Date" readonly>
                    <script>
                        $("#start-date").datepicker({
                            dateFormat: 'yy-mm-dd',
                            changeMonth: true,
                            changeYear: true,
                            yearRange:'new Date():2100',
                            minDate: new Date(),
                            defaultDate: new Date(),
                        })
                        var today = new Date();
                        var dd = String(today.getDate()).padStart(2, '0');
                        var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                        var yyyy = today.getFullYear();
                        today =  yyyy+'-'+mm+'-'+dd;
                        $("#start-date").val(today)
                    </script>
                </div>
                <div class="col-lg-3  col-md-3 col-sm-11 flex-box-column justify-content-start margin-top-2">
                    <label class="modal-p-2 ">End Date</label>
                    <input id="end-date" class="search-bar" type="text" placeholder="End Date" readonly>
                    <script>
                        //set end date base on startdate and interval
                        var availableDates = [];

                        function update_end_date() {

                            let interval = $("#interval").val();
                            //alert(interval)
                            if(isNaN(interval)){
                                interval=0
                            }
                            $.post('php/getDatesFromRange.php',{start_date: $("#start-date").val(),
                                end_date:'2025-01-01',
                                interval_days: interval
                            }).done(function (data) {
                                let datesObj = JSON.parse(data)
                                availableDates = datesObj;
                                console.log(availableDates)
                            })
                        }

                        function end_date_picker_instance() {
                            $("#end-date").datepicker({
                                dateFormat: 'yy-mm-dd',
                                changeMonth: true,
                                changeYear: true,
                                yearRange:'new Date():2100',
                                beforeShowDay: function(date){
                                    var string = jQuery.datepicker.formatDate('yy-mm-dd', date);
                                    return [$.inArray(string, availableDates) != -1];
                                },
                                minDate:  $("#start-date").val(),
                                defaultDate: $("#start-date").val(),
                            })
                        }
                        update_end_date()
                        end_date_picker_instance()
                        //actions
                        $("#start-date").change(function () {
                            update_end_date()
                            $("#end-date").val("")
                            end_date_picker_instance()
                        })
                        $("#frequency").change(function () {
                            update_end_date()
                            $("#end-date").val("")
                            end_date_picker_instance()
                        })
                        $("#interval").change(function () {
                            //if(isNaN(interval)){;return;}
                            if($("#interval").val()==""){return}
                            update_end_date()
                            $("#end-date").val("")
                            end_date_picker_instance()
                        })
                    </script>
                </div>
                <div class="col-lg-6 col-md-6 col-sm-11 flex-box-column justify-content-start margin-top-2">
                    <p class="modal-p-2"><span style="color: red">*</span>Description</p>
                    <textarea  id="description" class="search-bar" style="width: 100%;height: 12vh;padding: 0.5rem" placeholder="Description">
                </textarea>
                    <script>
                        $("#description").val("")
                    </script>
                    <style>
                        #description{
                            font-family: 'Poppins', sans-serif;
                            letter-spacing: 1px;
                            resize: vertical;
                        }
                    </style>
                </div>
            </div>

        </div>

<!--==================Add vaccine UI============-->
        <div id="add-vaccine-UI-cont"style="display: none">
            <div class="row justify-content-sm-center justify-content-md-start">


                <div class="col-lg-4 col-md-6  col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2 " >No. of  Dose Taken</label>
                    <input id="curr_dose" type="text" class="search-bar" value="x of x" readonly>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2 ">Last Vaccination</label>
                    <input id="last-given" class="search-bar" type="text" placeholder="none" readonly>
                    <script>
                        // $("#date-given").datepicker({
                        //     dateFormat: 'yy-mm-dd',
                        //     changeMonth: true,
                        //     changeYear: true,
                        //     yearRange:'new Date():2100',
                        //     minDate: new Date(),
                        //     defaultDate: new Date(),
                        // })
                        // var today = new Date();
                        // var dd = String(today.getDate()).padStart(2, '0');
                        // var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                        // var yyyy = today.getFullYear();
                        // today =  yyyy+'-'+mm+'-'+dd;
                        // $("#date-given").val(today)
                    </script>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2 ">Next Schedule</label>
                    <div class="flex-box-row align-items-center">
                        <input id="next-date" class="search-bar" type="text" placeholder="none" readonly>
                        <!--                        <i id="del-next-sched" class="fas fa-trash-alt fa-lg" style="color: var(&#45;&#45;third-color);margin-left: 0.2rem"></i>-->
                    </div>
                    <script>
                        $("#del-next-sched").click(function () {
                            $("#next-date").val("")
                        }).mouseover(function () {
                            $(this).css("color","grey")
                        }).mouseleave(function () {
                            $(this).css("color"," var(--third-color)")
                        })
                        // $("#next-date").datepicker({
                        //     dateFormat: 'yy-mm-dd',
                        //     changeMonth: true,
                        //     changeYear: true,
                        //     yearRange:'new Date():2100',
                        //     minDate: new Date(),
                        //     defaultDate: new Date(),
                        // })
                        // var today = new Date();
                        // var dd = String(today.getDate()).padStart(2, '0');
                        // var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                        // var yyyy = today.getFullYear();
                        // today =  yyyy+'-'+mm+'-'+dd;
                    </script>
                </div>
            </div>
            <div class="row justify-content-sm-center justify-content-lg-center">

                <div class="col-lg-4 col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <label class="modal-p-2 " ><span style="color: red;font-size: large">*</span>Recommended No. of Dose</label>
                    <input id="rec_no_dosage" type="number" class="search-bar" placeholder="x">
                    <script>
                        $("#rec_no_dosage").keyup(function () {
                            let val = $(this).val();
                            if(val.length=0){
                                $("#set-next-sched-cont").css("display","none")
                                $("#set-next-sched").val("")
                            }
                            else if(parseInt(val)>1){
                                $("#set-next-sched-cont").css("display","block")
                            }
                            else {
                                $("#set-next-sched-cont").css("display","none")
                                $("#set-next-sched").val("")
                            }
                            $(".modal-p-error").css("visibility","hidden")
                        }).on("wheel",function () {//disable scroll in number input
                            $(this).blur();
                        })
                    </script>
                </div>
                <div class="col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                    <p class="modal-p-2"><span style="color: red;font-size: large">*</span>Description</p>
                    <textarea  id="description-vaccine" class="search-bar" style="width: 100%;height: 12vh;padding: 0.5rem" placeholder="Description">
                    </textarea>
                    <script>
                        $("#description-vaccine").val("")
                    </script>
                    <style>
                        #description-vaccine{
                            font-family: 'Poppins', sans-serif;
                            letter-spacing: 1px;
                            resize: vertical;
                        }
                    </style>
                </div>
            </div>
            <div class="row margin-top-2">
                <div class="col-sm-12 flex-box-row justify-content-center">
                    <h5 id="vaccine-message" style="color: darkred;visibility: hidden">Cannot give a dose of <strong id="vaccine-name-lower" style="color: #212020">xxx</strong>. Too early to the next sched</h5>
                </div>
            </div>


           <div id="set-next-sched-cont" class="row margin-top-2 justify-content-center" style="display: none">
               <p class="modal-p" style="text-align: center!important;"><span style="color: red">*Note: </span>Set schedule for the next dose</p>
               <div class="col-lg-12 flex-box-row align-items-center justify-content-center" style="flex-wrap: wrap">
                   <div class="flex-box-column margin-top-1" style="flex: 0 1 50%;">
                       <div class="flex-box-row align-items-center">
                           <input id="set-next-sched" type="text" class="search-bar" readonly placeholder="Set Next Schedule">
                           <i id="reset-set-next-sched" class="fas fa-trash-alt fa-lg" style="color: var(--third-color);margin-left: 0.3rem"></i>
                           <script>
                               $("#set-next-sched").datepicker({
                                   dateFormat: 'yy-mm-dd',
                                   changeMonth: true,
                                   changeYear: true,
                                   yearRange:'new Date():2100',
                                   minDate: new Date(),
                                   defaultDate: new Date(),
                               })
                               $("#reset-set-next-sched").click(function () {
                                   $("#set-next-sched").val("")
                               })
                           </script>
                       </div>
                   </div>
<!--                   <div class="flex-box-column margin-top-1" style="flex: 0 1 100%;">-->
<!--                       <div class="flex-box-row align-items-start justify-content-center">-->
<!--                           <button style="padding: 0.5rem;font-family: 'Poppins', sans-serif;border:none" data-status="no">-->
<!--                               No Next Schedule. This is the last dose-->
<!--                           </button>-->
<!--                       </div>-->
<!--                   </div>-->

               </div>
           </div>

        </div>
<!--        end of  vaccineUI cont-->


        <div id="lower-part" class="row flex-box-row justify-content-center align-items-center margin-top-1">
            <div class="col-lg-6 col-md-6 col-sm-11 flex-box-column justify-content-center align-items-lg-end align-items-sm-center margin-top-2">
                <div class="flex-box-column">
                    <label class="modal-p-2 "><span style="color: red">*</span>Quantity to Give</label>
                    <input id="qty" class="search-bar" type="number" placeholder="x">
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-11 flex-box-column justify-content-end align-items-sm-center align-items-lg-start margin-top-2">
                <p id="inv-name-and-qty-lbl" class="modal-p-2" style="padding: 0!important;">
<!--                    <span id="med-name-2">Medicine</span> currently has <span id="med-stock-2">500</span> stocks.-->
                    Nothing is selected
                </p>
                <style>
                    #inv-stock-2{
                        color: var(--primary-color);
                        font-size: larger !important;
                    }
                    #inv-name-2{
                        font-weight: 450!important;
                    }
                </style>
            </div>
        </div>
        <style>
                #lower-part{
                    /*border-top: 2px solid #F4F2F4;padding-bottom: 1rem;*/
                    /*border-radius: 0.5rem;*/
                    /*background: #EEEEEE;*/
                }
                #qty{
                   font-weight: 450!important;
                    text-align: center;
                }
        </style>

        <div class="flex-box-row justify-content-lg-center justify-content-sm-end margin-top-1 align-items-lg-start" style="border-top: 2px solid #F4F2F4;padding-top:0!important;">
            <p class="modal-p-error" style="padding: 0 !important;">Please fill all the required fields!</p>
            <script>
                $("input").focus(function () {
                    $(".modal-p-error").css('visibility','hidden')
                })
            </script>
        </div>
        <!--row-->
        <div  class="row flex-box-row justify-content-sm-end justify-content-lg-center margin-top-1" >
            <a href="#add-pres-modal" rel="modal:close">
                <button class="modal-cancel-button">
                    <i class="fas fa-times" style="margin-right: 0.3rem"></i>
                    Cancel
                </button>
            </a>
            <button id="add-vaccine-btn"  class="modal-primary-button-2 prescript-btn-class" style="margin-left: 0.5rem">
<!--                add-vaccine-btn , add-prescript-btn-->
                <i class="fas fa-plus" style="margin-right: 0.3rem"></i>
                Prescribe
            </button>
        </div>

    </div><!--Scrollable end-->

</div><!--Modal end-->
<style>
    button.type{
        padding: 0.5rem 1rem;
        font-size: clamp(1em,1.6em,2vw);
        margin: 1rem;
    }
    #res tr th, #res tr td{
        text-align: left;
    }
    #res tr th{
        display: none;
    }
</style>
<!--modal for confirming prescription-->
<div id="pop-up-confirm-add" class="modal">
    <div class="flex-box-row justify-content-center align-items-center">

        <p class="modal-p flex-box-row justify-content-center align-items-center">
            <img class="modal-header-icon" src="img/question.png" style="margin-right: 0.3rem">
            Prescribe?
        </p>
    </div>

    <div class="flex-box-row justify-content-end align-items-end">
        <a href="#pop-up-confirm-add" rel="modal:close">
            <button class="modal-cancel-button"  style="margin-right: 0.5rem">Cancel</button>
        </a>
        <button class="modal-primary-button" id="prescribe-final-btn" style="margin-left: 0.5rem">Confirm</button>
    </div>
</div>