<div class="modal modal-md-width" id="add-pres-modal">
    <div class="flex-box-row justify-content-center" style="border-bottom: 2px solid #F4F2F4;padding-bottom: 1rem">
        <h4 style="color: var(--third-color);display: flex;align-items: center">
            <img src="img/prescription.png" class="modal-icon-wider">
            <!--                <i class="fas fa-file-prescription fa-2x" style="margin-right: 0.5rem"></i>-->
            Prescription
        </h4>
    </div>
    <div id="modal-upper-info" class="flex-box-row justify-content-center" style="padding-bottom: 1rem;margin-top: 0.5rem">
        <div class="flex-box-column align-items-start" style="flex: 1 1 50%">
            <p id="modal-patient-name" class="modal-p-2">To: Alfredo B. Benitez</p>
            <p id="modal-patient-type" class="modal-p-2">Type: Adult</p>
        </div>
        <div class="flex-box-column align-items-end" style="flex: 1 1 50%">
            <p id="modal-curr-date" class="modal-p-2"></p>
            <p id="modal-admin-name" class="modal-p-2">Given by: DR kwakwak</p>
        </div>
        <script>
            let date= new Date()
            const options = {  year: 'numeric', month: 'long', day: 'numeric' };
            $("#modal-curr-date").html(date.toLocaleDateString(undefined,options))
        </script>
    </div>
    <div class="padding-all-15">
        <!--Searchbar-->
        <div  class="row flex-box-row justify-content-sm-end justify-content-lg-center">
            <div class="col-lg-8 col-md-7 col-sm-8" >
                <p class="modal-p-2" style="margin-bottom: 0.2rem!important;">Search Medicine or Vaccine</p>
                <div class="search-container-2">
                    <a href="/"><i class="fas fa-search"></i></a>
                    <input type="text" id="search-inv" class="search-bar-2" placeholder="Search">
                </div>
            </div>
        </div>
        <style>
            .search-container-2{
                color: var(--third-color)!important;
                display: flex;
                flex-flow: row;
                background: #f1f4ff;
                border-radius: 0.4rem;
                box-shadow: 0px 2px 7px -1px rgba(0,0,0,0.5);
                -webkit-box-shadow: 0px 2px 7px -1px rgba(0,0,0,0.5);
                -moz-box-shadow: 0px 2px 7px -1px rgba(0,0,0,0.5);
            }
            .search-container-2 a{
                flex: 0 1 auto;
                display: flex;
                justify-content: end;
                padding: 0.5rem 0.5rem 0.5rem 0.5rem !important;
                color: inherit;
            }
            .search-container-2 .search-bar-2{
                flex: 0 1 90%;
                margin: 0 !important;
                border: none !important;
                padding: 0.6rem 1rem !important;
                background: none !important;
                border-radius: 0 !important;
            }
            .search-container-2 .search-bar-2:focus{
                border: 1px solid #D4D7D9 !important;
            }
        </style>


<!--        &lt;!&ndash;Searchbar&ndash;&gt;-->
<!--        <div  class="row flex-box-row justify-content-sm-end justify-content-md-center">-->
<!--            <div class="col-lg-8 col-md-7 col-sm-8" >-->
<!--                <label class="><span style="color: red">*</span>Search for Medicine</label>-->
<!--                <div class="search-container">-->
<!--                    <input type="text" id="search-inv" class="search-bar">-->
<!--                    <a href="/"><i class="fas fa-search"></i></a>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
        <!--first row-->
        <div class="row flex-box-row justify-content-center margin-top-1">
            <div class="col-lg-6 col-md-12 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 ">Selected <span id="inv-category-lbl">Medicine</span></label>
                    <input id="med-name" type="text" class="search-bar" placeholder="none" readonly>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 ">Type</label>
                    <input id="med-type" class="search-bar" type="text" placeholder="none" readonly>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 "><span id="sub-category-lbl">Medicine</span> Category</label>
                <input id="sub-category" class="search-bar" type="text" placeholder="none" readonly>
            </div>

        </div>

        <!--row-->
<!--        <div class="row flex-box-row justify-content-center">-->
<!--            <div class="col-lg-6 col-sm-11">-->
<!--                <label class="modal-p-2"><span style="color: red">*</span>Frequency</label>-->
<!--                <div class="flex-box-row justify-content-center">-->
<!--                    <input type="radio" name="frequency" value="Daily">-->
<!--                    <label class=" style="margin-right: 0.5rem">Daily</label>-->
<!--                    <input type="radio" value="Daily">-->
<!--                    <label class=">Every other day</label>-->
<!--                </div>-->
<!--            </div>-->
<!--            <div class="col-lg-6 col-sm-11">-->
<!--                <label class="modal-p-2"><span style="color: red">*</span>Interval /day</label>-->
<!--                <input type="number" id="interval" class="search-bar" placeholder="dosage">-->
<!--            </div>-->
<!--        </div>-->


        <!--row-->
        <div class="row flex-box-row justify-content-center">

            <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 "><span style="color: red">*</span>Dosage /mg</label>
                <input type="number" id="dosage" class="search-bar" placeholder="x">
            </div>
            <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 "><span style="color: red">*</span>Times per day</label>
                <input type="number" id="no_of_times" class="search-bar" placeholder="x">
            </div>
            <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2 ">Frequency</label>
                <select id="frequency" class="search-bar">
                    <option value="0">Daily</option>
                    <option value="1">Every other day</option>
                </select>
                <script>
                    $("#frequency").change(function () {
                        let val =  $(this).val();
                        if(val==0){
                            $("#interval-lbl").css('opacity','0.3')
                            $("#interval").prop('type','text').val("none").css('opacity','0.3').prop('readonly',true)
                        }
                        else {
                            $("#interval-lbl").css('opacity','1')
                            $("#interval").val("").css('opacity','1').prop('type','number').prop('readonly',false).val(1)
                        }
                    })
                </script>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-11 flex-box-column justify-content-end margin-top-2">
                <label class="modal-p-2" id="interval-lbl">Interval in days</label>
                <input type="text" id="interval" class="search-bar" placeholder="x" readonly>
                <script>
                    $("#interval-lbl").css('opacity','0.3')
                    $("#interval").val("None").css('opacity','0.3')
                </script>
            </div>

        </div>

        <!--row-->
        <div class="row flex-box-row justify-content-center" style="border-bottom: 2px solid #F4F2F4;padding-bottom: 1rem">
            <div class="col-lg-3  col-md-3 col-sm-11 flex-box-column justify-content-start margin-top-2">
                <label class="modal-p-2 "><span style="color: red">*</span>Start Date</label>
                <input id="start-date" class="search-bar" type="text" placeholder="Start Date" readonly>
                <script>
                    $("#start-date").datepicker({
                        dateFormat: 'yy-mm-dd',
                        changeMonth: true,
                        changeYear: true,
                        yearRange:'new Date():2100',
                        minDate: new Date(),
                        defaultDate: new Date(),
                    })
                    var today = new Date();
                    var dd = String(today.getDate()).padStart(2, '0');
                    var mm = String(today.getMonth() + 1).padStart(2, '0'); //January is 0!
                    var yyyy = today.getFullYear();
                    today =  yyyy+'-'+mm+'-'+dd;
                    $("#start-date").val(today)
                </script>
            </div>
            <div class="col-lg-3  col-md-3 col-sm-11 flex-box-column justify-content-start margin-top-2">
                <label class="modal-p-2 ">End Date</label>
                <input id="end-date" class="search-bar" type="text" placeholder="End Date" readonly>
                <script>
                    //set end date base on startdate and interval
                    var availableDates = [];

                    function update_end_date() {

                        let interval = $("#interval").val();
                        if(isNaN(interval)){
                            interval=0
                        }
                        $.post('php/getDatesFromRange.php',{start_date: $("#start-date").val(),
                            end_date:'2025-01-01',
                            interval_days: interval
                        }).done(function (data) {
                            let datesObj = JSON.parse(data)
                            availableDates = datesObj;
                            console.log(availableDates)
                        })
                    }

                    function end_date_picker_instance() {
                        $("#end-date").datepicker({
                            dateFormat: 'yy-mm-dd',
                            changeMonth: true,
                            changeYear: true,
                            yearRange:'new Date():2100',
                            beforeShowDay: function(date){
                                var string = jQuery.datepicker.formatDate('yy-mm-dd', date);
                                return [$.inArray(string, availableDates) != -1];
                            },
                            minDate:  $("#start-date").val(),
                            defaultDate: $("#start-date").val(),
                        })
                    }
                    update_end_date()
                    end_date_picker_instance()
                    //actions
                    $("#start-date").change(function () {
                        update_end_date()
                        $("#end-date").val("")
                        end_date_picker_instance()
                    })
                    $("#frequency").change(function () {
                        update_end_date()
                        $("#end-date").val("")
                        end_date_picker_instance()
                    })
                    $("#interval").change(function () {
                        if(isNaN(interval)){return}
                        update_end_date()
                        $("#end-date").val("")
                        end_date_picker_instance()
                    })
                </script>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-11 flex-box-column justify-content-start margin-top-2">
                <p class="modal-p-2"><span style="color: red">*</span>Description</p>
                <textarea  id="description" class="search-bar" style="width: 100%;height: 12vh;padding: 0.5rem" placeholder="Description">
                </textarea>
                <script>
                    $("#description").val("")
                </script>
                <style>
                    #description{
                        font-family: 'Poppins', sans-serif;
                        letter-spacing: 1px;
                        resize: vertical;
                    }
                </style>
            </div>
        </div>

        <div id="lower-part" class="row flex-box-row justify-content-center align-items-center margin-top-1">
            <div class="col-lg-6 col-md-6 col-sm-11 flex-box-column justify-content-center align-items-lg-end align-items-sm-center margin-top-2">
                <div class="flex-box-column">
                    <label class="modal-p-2 "><span style="color: red">*</span>Quantity to Give</label>
                    <input id="qty" class="search-bar" type="number" placeholder="x">
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-11 flex-box-column justify-content-end align-items-sm-center align-items-lg-start margin-top-2">
                <p id="med-name-and-qty-lbl" class="modal-p-2" style="padding: 0!important;">
<!--                    <span id="med-name-2">Medicine</span> currently has <span id="med-stock-2">500</span> stocks.-->
                    Nothing is selected
                </p>
                <style>
                    #med-stock-2{
                        color: var(--primary-color);
                        font-size: larger !important;
                    }
                    #med-name-2{
                        font-weight: 450!important;
                    }
                </style>
            </div>
        </div>
        <style>
                #lower-part{
                    border-top: 2px solid #F4F2F4;padding-bottom: 1rem;
                    border-radius: 0.5rem;
                    background: #EEEEEE;
                }
                #qty{
                   font-weight: 450!important;
                    text-align: center;
                }
        </style>

        <div class="flex-box-row justify-content-lg-center justify-content-sm-end margin-top-1 align-items-lg-start" style="border-top: 2px solid #F4F2F4;padding-top:0!important;">
            <p class="modal-p-error" style="padding: 0 !important;">Please fill all the required fields!</p>
            <script>
                $("input").focus(function () {
                    $(".modal-p-error").css('visibility','hidden')
                })
            </script>
        </div>
        <!--row-->
        <div  class="row flex-box-row justify-content-sm-end justify-content-lg-center margin-top-1" >
            <a href="#add-pres-modal" rel="modal:close">
                <button class="modal-cancel-button">
                    <i class="fas fa-times" style="margin-right: 0.3rem"></i>
                    Cancel
                </button>
            </a>
            <button id="add-prescript-btn"  class="modal-primary-button-2" style="margin-left: 0.5rem">
                <i class="fas fa-plus" style="margin-right: 0.3rem"></i>
                Prescribe
            </button>
        </div>

    </div><!--Scrollable end-->

</div><!--Modal end-->
<style>
    button.type{
        padding: 0.5rem 1rem;
        font-size: clamp(1em,1.6em,2vw);
        margin: 1rem;
    }
    #res tr th, #res tr td{
        text-align: left;
    }
    #res tr th{
        display: none;
    }
</style>
<!--modal for confirming prescription-->
<div id="pop-up-confirm-add" class="modal">
    <div class="flex-box-row justify-content-center align-items-center">

        <p class="modal-p flex-box-row justify-content-center align-items-center">
            <img class="modal-header-icon" src="img/question.png" style="margin-right: 0.3rem">
            Prescribe?
        </p>
    </div>

    <div class="flex-box-row justify-content-end align-items-end">
        <a href="#pop-up-confirm-add" rel="modal:close">
            <button class="modal-cancel-button"  style="margin-right: 0.5rem">Cancel</button>
        </a>
        <button class="modal-primary-button" id="prescribe-final-btn" style="margin-left: 0.5rem">Confirm</button>
    </div>
</div>